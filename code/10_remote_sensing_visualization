# Code to visualize remote sensing data

# the data we are using this lesson are stored in this link - Zenodo set: https://zenodo.org/records/15645465
# install.packages("imageRy")

library(imageRy)
library(terra)
library(viridis)

# Listing data inside imageRy
im.list()
# there is a satellite called sentinel that is covering the planet every 10 days: good date to deal with, we are going to use it 
# in the satellite there are different sensor that look with differt wavelenght


# importing the first band
b2 <- im.import("sentinel.dolomites.b2.tif")
plot(b2)
#with the plot we are looking at the reflectance (slides su virtuale)

#changing the color with viridis package (call library)
plot(b2, col=magma(100))

# import and plot green band 3 with the legend mako from viridis  
#band 3 it is in 560nm wave length
b3 <- im.import("sentinel.dolomites.b3.tif")
plot(b3)
plot(b3, col=mako(100))


cl <- colorRampPalette(c("black","grey","white"))(100)
plot(b3, col=cl)
plot(b2, col=cl)

# multiframe two plot together
par(mfrow=c(1,2))
# or doing it by creating our own function
im.multiframe(1,2)
plot(b2, col=cl)
plot(b3, col=cl)

# or doing it by creating our own function: the multiframe from the CRAN is not properly working, so use the GitHub version:
multiframe <- function(x,y){
   par(mfrow=c(x,y))
   }

dev.off()
plot(b2,b3)

#excercise:
multiframe (1,3)
plot(b2, col=cl) 
plot(b3, col=cl) 
plot(b2, b3) 

dev.off()
# Exercise: import band 4 (655 nm wavelenght)
b4 <- im.import("sentinel.dolomites.b4.tif")
plot(b4)
plot(b4, col=cl)


# import band 8
b8 <- im.import("sentinel.dolomites.b8.tif")
plot(b8)

im.multiframe(1,2)
plot(b4)
plot(b8)

#using multiframe function to plot all the four bands:
#b2 b3
#b4 b8
multiframe(2,2)
plot (b2, col=inferno(100))
plot (b3, col=inferno(100))
plot (b4, col=inferno(100))
plot (b8, col=inferno(100))

#excercise: plot the following relationships: b2,b3 and b2,b8
multiframe(1,2)
plot (b2,b3, xlab="band2-blue", ylab="band3-green", main="relationship b2 vs. b3")

plot (b2,b8, xlab="band2-blue", ylab="band8-IFred",main="relationship b2 vs. b8")
#the correlation is not direct as in the previous relationship

#friday lesson
#creating colored images
sent<- c( b2,b3,b4,b8)

#layer 1= original from sentinel b2= blue
#layer 2= b3= green
#layer 3= original from sentinel b4= red
#layer 4= original from sentinel b8= NIR

#spat raster is the name of the class of sent 
#natural color image creating using the RGB scheme:
dev.off()
im.plotRGB(sent,r=3,g=2,b=1, title="natural color")

#lets use the IR to identify the vegetation: falso color image
im.plotRGB(sent,r=4,g=3,b=2, title="false color")
#we put the IR over the red layer so everithing is red, differently based on the vegetation and water on the image

#put it on top of the green component
im.plotRGB(sent,r=3,g=4,b=1, title="false color")

#put it on top of the blue component
im.plotRGB(sent,r=3,g=2,b=4, title="false color")

multiframe(2,2)

b2 <- im.import("sentinel.dolomites.b2.tif")
b3 <- im.import("sentinel.dolomites.b3.tif")
b4 <- im.import("sentinel.dolomites.b4.tif")
b8 <- im.import("sentinel.dolomites.b8.tif")

#this it ois not working with the CRAN version, thwe professor will check the problem

